{"ast":null,"code":"var _jsxFileName = \"/home/Charging/_final_test/Finans_PAMW/frontend/src/context/AppContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AppContext = /*#__PURE__*/createContext();\nexport const AppProvider = ({\n  children\n}) => {\n  _s();\n  const [transactions, setTransactions] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [budget, setBudget] = useState(0);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [successMessage, setSuccessMessage] = useState(\"\");\n  const [token, setToken] = useState(null);\n  const [isReady, setIsReady] = useState(false);\n  const [newTransaction, setNewTransaction] = useState({\n    description: \"\",\n    amount: \"\",\n    type: \"\",\n    category_ids: [],\n    date: \"\"\n  });\n\n  // Charger le token depuis localStorage au démarrage\n  useEffect(() => {\n    const storedToken = localStorage.getItem(\"token\");\n    if (storedToken) setToken(storedToken);\n    setIsReady(true);\n  }, []);\n\n  // Charger les transactions quand le token est prêt\n  useEffect(() => {\n    if (!token) return;\n    const fetchTransactions = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:5000/transactions/\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        const sanitized = (res.data.transactions || []).map(t => ({\n          ...t,\n          categories: Array.isArray(t.categories) ? t.categories : []\n        }));\n        setTransactions(sanitized);\n      } catch (err) {\n        console.error(\"Erreur chargement transactions :\", err);\n        setErrorMessage(\"Impossible de charger les transactions (token invalide ?)\");\n      }\n    };\n    fetchTransactions();\n  }, [token]);\n\n  // Charger les catégories\n  useEffect(() => {\n    const fetchCategories = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:5000/categories/\");\n        setCategories(res.data.categories || res.data);\n      } catch (err) {\n        console.error(\"Erreur chargement catégories :\", err);\n        setErrorMessage(\"Impossible de charger les catégories.\");\n      }\n    };\n    fetchCategories();\n  }, []);\n\n  // Ajouter une transaction\n  const addTransaction = async payload => {\n    if (!token) {\n      setErrorMessage(\"Token manquant. Veuillez vous reconnecter.\");\n      return;\n    }\n    try {\n      const response = await axios.post(\"http://localhost:5000/transactions/\", payload, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const t = {\n        ...response.data.transaction,\n        categories: Array.isArray(response.data.transaction.categories) ? response.data.transaction.categories : []\n      };\n      setTransactions(prev => [...prev, t]);\n    } catch (err) {\n      console.error(\"Erreur ajout transaction :\", err);\n      setErrorMessage(\"Impossible d’ajouter la transaction.\");\n    }\n  };\n\n  // Supprimer une transaction\n  const deleteTransaction = async id => {\n    if (!token) return;\n    try {\n      await axios.delete(`http://localhost:5000/transactions/${id}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setTransactions(prev => prev.filter(t => t.id !== id));\n    } catch (err) {\n      console.error(\"Erreur suppression transaction :\", err);\n      setErrorMessage(\"Impossible de supprimer la transaction.\");\n    }\n  };\n\n  // Charger le budget\n  const fetchBudget = async () => {\n    const token = localStorage.getItem(\"token\");\n    console.log(\"\");\n    if (!token) {\n      setErrorMessage(\"Token manquant. Veuillez vous reconnecter.\");\n      return;\n    }\n    try {\n      const response = await fetch(\"http://localhost:5000/accounts/\", {\n        method: \"GET\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": `Bearer ${token}`\n        }\n      });\n      if (!response.ok) {\n        const errData = await response.json();\n        throw new Error(errData.message || \"Erreur lors du chargement du budget\");\n      }\n      const data = await response.json();\n      console.log(\"Budget chargé :\", data.balance);\n\n      // Assurez-vous que le backend renvoie bien data.totalBudget\n      setBudget(data.totalBudget || 0);\n    } catch (err) {\n      console.error(\"Erreur chargement budget :\", err);\n      setErrorMessage(\"Impossible de charger le budget.\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(AppContext.Provider, {\n    value: {\n      token,\n      setToken,\n      isReady,\n      transactions,\n      setTransactions,\n      categories,\n      setCategories,\n      budget,\n      errorMessage,\n      successMessage,\n      setErrorMessage,\n      setSuccessMessage,\n      newTransaction,\n      setNewTransaction,\n      addTransaction,\n      deleteTransaction,\n      fetchBudget\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 5\n  }, this);\n};\n_s(AppProvider, \"xjyWoUbx1MZx7FRL/Amd7+K5K9A=\");\n_c = AppProvider;\nvar _c;\n$RefreshReg$(_c, \"AppProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","axios","jsxDEV","_jsxDEV","AppContext","AppProvider","children","_s","transactions","setTransactions","categories","setCategories","budget","setBudget","errorMessage","setErrorMessage","successMessage","setSuccessMessage","token","setToken","isReady","setIsReady","newTransaction","setNewTransaction","description","amount","type","category_ids","date","storedToken","localStorage","getItem","fetchTransactions","res","get","headers","Authorization","sanitized","data","map","t","Array","isArray","err","console","error","fetchCategories","addTransaction","payload","response","post","transaction","prev","deleteTransaction","id","delete","filter","fetchBudget","log","fetch","method","ok","errData","json","Error","message","balance","totalBudget","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/home/Charging/_final_test/Finans_PAMW/frontend/src/context/AppContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from \"react\";\nimport axios from \"axios\";\n\nexport const AppContext = createContext();\n\nexport const AppProvider = ({ children }) => {\n  const [transactions, setTransactions] = useState([]);\n  const [categories, setCategories] = useState([]);\n  const [budget, setBudget] = useState(0);\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [successMessage, setSuccessMessage] = useState(\"\");\n  const [token, setToken] = useState(null);\n  const [isReady, setIsReady] = useState(false);\n\n  const [newTransaction, setNewTransaction] = useState({\n    description: \"\",\n    amount: \"\",\n    type: \"\",\n    category_ids: [],\n    date: \"\",\n  });\n\n  // Charger le token depuis localStorage au démarrage\n  useEffect(() => {\n    const storedToken = localStorage.getItem(\"token\");\n    if (storedToken) setToken(storedToken);\n    setIsReady(true);\n  }, []);\n\n  // Charger les transactions quand le token est prêt\n  useEffect(() => {\n    if (!token) return;\n\n    const fetchTransactions = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:5000/transactions/\", {\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        const sanitized = (res.data.transactions || []).map((t) => ({\n          ...t,\n          categories: Array.isArray(t.categories) ? t.categories : [],\n        }));\n        setTransactions(sanitized);\n      } catch (err) {\n        console.error(\"Erreur chargement transactions :\", err);\n        setErrorMessage(\"Impossible de charger les transactions (token invalide ?)\");\n      }\n    };\n    fetchTransactions();\n  }, [token]);\n\n  // Charger les catégories\n  useEffect(() => {\n    const fetchCategories = async () => {\n      try {\n        const res = await axios.get(\"http://localhost:5000/categories/\");\n        setCategories(res.data.categories || res.data);\n      } catch (err) {\n        console.error(\"Erreur chargement catégories :\", err);\n        setErrorMessage(\"Impossible de charger les catégories.\");\n      }\n    };\n    fetchCategories();\n  }, []);\n\n  // Ajouter une transaction\n  const addTransaction = async (payload) => {\n    if (!token) {\n      setErrorMessage(\"Token manquant. Veuillez vous reconnecter.\");\n      return;\n    }\n\n    try {\n      const response = await axios.post(\n        \"http://localhost:5000/transactions/\",\n        payload,\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      const t = {\n        ...response.data.transaction,\n        categories: Array.isArray(response.data.transaction.categories)\n          ? response.data.transaction.categories\n          : [],\n      };\n\n      setTransactions((prev) => [...prev, t]);\n    } catch (err) {\n      console.error(\"Erreur ajout transaction :\", err);\n      setErrorMessage(\"Impossible d’ajouter la transaction.\");\n    }\n  };\n\n  // Supprimer une transaction\n  const deleteTransaction = async (id) => {\n    if (!token) return;\n\n    try {\n      await axios.delete(`http://localhost:5000/transactions/${id}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      setTransactions((prev) => prev.filter((t) => t.id !== id));\n    } catch (err) {\n      console.error(\"Erreur suppression transaction :\", err);\n      setErrorMessage(\"Impossible de supprimer la transaction.\");\n    }\n  };\n\n  // Charger le budget\nconst fetchBudget = async () => {\n  const token = localStorage.getItem(\"token\");\n  console.log(\"\")\n  if (!token) {\n    setErrorMessage(\"Token manquant. Veuillez vous reconnecter.\");\n    return;\n  }\n\n  try {\n    const response = await fetch(\"http://localhost:5000/accounts/\", {\n      method: \"GET\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": `Bearer ${token}`,\n      },\n    });\n\n    if (!response.ok) {\n      const errData = await response.json();\n      throw new Error(errData.message || \"Erreur lors du chargement du budget\");\n    }\n\n    const data = await response.json();\n    console.log(\"Budget chargé :\", data.balance);\n\n    // Assurez-vous que le backend renvoie bien data.totalBudget\n    setBudget(data.totalBudget || 0);\n  } catch (err) {\n    console.error(\"Erreur chargement budget :\", err);\n    setErrorMessage(\"Impossible de charger le budget.\");\n  }\n};\n\n  return (\n    <AppContext.Provider\n      value={{\n        token,\n        setToken,\n        isReady,\n        transactions,\n        setTransactions,\n        categories,\n        setCategories,\n        budget,\n        errorMessage,\n        successMessage,\n        setErrorMessage,\n        setSuccessMessage,\n        newTransaction,\n        setNewTransaction,\n        addTransaction,\n        deleteTransaction,\n        fetchBudget,\n      }}\n    >\n      {children}\n    </AppContext.Provider>\n  );\n};\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AACjE,OAAOC,KAAK,MAAM,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE1B,OAAO,MAAMC,UAAU,gBAAGN,aAAa,CAAC,CAAC;AAEzC,OAAO,MAAMO,WAAW,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAC3C,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGV,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACW,UAAU,EAAEC,aAAa,CAAC,GAAGZ,QAAQ,CAAC,EAAE,CAAC;EAChD,MAAM,CAACa,MAAM,EAAEC,SAAS,CAAC,GAAGd,QAAQ,CAAC,CAAC,CAAC;EACvC,MAAM,CAACe,YAAY,EAAEC,eAAe,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC;EACpD,MAAM,CAACiB,cAAc,EAAEC,iBAAiB,CAAC,GAAGlB,QAAQ,CAAC,EAAE,CAAC;EACxD,MAAM,CAACmB,KAAK,EAAEC,QAAQ,CAAC,GAAGpB,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACqB,OAAO,EAAEC,UAAU,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAE7C,MAAM,CAACuB,cAAc,EAAEC,iBAAiB,CAAC,GAAGxB,QAAQ,CAAC;IACnDyB,WAAW,EAAE,EAAE;IACfC,MAAM,EAAE,EAAE;IACVC,IAAI,EAAE,EAAE;IACRC,YAAY,EAAE,EAAE;IAChBC,IAAI,EAAE;EACR,CAAC,CAAC;;EAEF;EACA5B,SAAS,CAAC,MAAM;IACd,MAAM6B,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IACjD,IAAIF,WAAW,EAAEV,QAAQ,CAACU,WAAW,CAAC;IACtCR,UAAU,CAAC,IAAI,CAAC;EAClB,CAAC,EAAE,EAAE,CAAC;;EAEN;EACArB,SAAS,CAAC,MAAM;IACd,IAAI,CAACkB,KAAK,EAAE;IAEZ,MAAMc,iBAAiB,GAAG,MAAAA,CAAA,KAAY;MACpC,IAAI;QACF,MAAMC,GAAG,GAAG,MAAMhC,KAAK,CAACiC,GAAG,CAAC,qCAAqC,EAAE;UACjEC,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAUlB,KAAK;UAAG;QAC9C,CAAC,CAAC;QACF,MAAMmB,SAAS,GAAG,CAACJ,GAAG,CAACK,IAAI,CAAC9B,YAAY,IAAI,EAAE,EAAE+B,GAAG,CAAEC,CAAC,KAAM;UAC1D,GAAGA,CAAC;UACJ9B,UAAU,EAAE+B,KAAK,CAACC,OAAO,CAACF,CAAC,CAAC9B,UAAU,CAAC,GAAG8B,CAAC,CAAC9B,UAAU,GAAG;QAC3D,CAAC,CAAC,CAAC;QACHD,eAAe,CAAC4B,SAAS,CAAC;MAC5B,CAAC,CAAC,OAAOM,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,kCAAkC,EAAEF,GAAG,CAAC;QACtD5B,eAAe,CAAC,2DAA2D,CAAC;MAC9E;IACF,CAAC;IACDiB,iBAAiB,CAAC,CAAC;EACrB,CAAC,EAAE,CAACd,KAAK,CAAC,CAAC;;EAEX;EACAlB,SAAS,CAAC,MAAM;IACd,MAAM8C,eAAe,GAAG,MAAAA,CAAA,KAAY;MAClC,IAAI;QACF,MAAMb,GAAG,GAAG,MAAMhC,KAAK,CAACiC,GAAG,CAAC,mCAAmC,CAAC;QAChEvB,aAAa,CAACsB,GAAG,CAACK,IAAI,CAAC5B,UAAU,IAAIuB,GAAG,CAACK,IAAI,CAAC;MAChD,CAAC,CAAC,OAAOK,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,gCAAgC,EAAEF,GAAG,CAAC;QACpD5B,eAAe,CAAC,uCAAuC,CAAC;MAC1D;IACF,CAAC;IACD+B,eAAe,CAAC,CAAC;EACnB,CAAC,EAAE,EAAE,CAAC;;EAEN;EACA,MAAMC,cAAc,GAAG,MAAOC,OAAO,IAAK;IACxC,IAAI,CAAC9B,KAAK,EAAE;MACVH,eAAe,CAAC,4CAA4C,CAAC;MAC7D;IACF;IAEA,IAAI;MACF,MAAMkC,QAAQ,GAAG,MAAMhD,KAAK,CAACiD,IAAI,CAC/B,qCAAqC,EACrCF,OAAO,EACP;QAAEb,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUlB,KAAK;QAAG;MAAE,CAClD,CAAC;MAED,MAAMsB,CAAC,GAAG;QACR,GAAGS,QAAQ,CAACX,IAAI,CAACa,WAAW;QAC5BzC,UAAU,EAAE+B,KAAK,CAACC,OAAO,CAACO,QAAQ,CAACX,IAAI,CAACa,WAAW,CAACzC,UAAU,CAAC,GAC3DuC,QAAQ,CAACX,IAAI,CAACa,WAAW,CAACzC,UAAU,GACpC;MACN,CAAC;MAEDD,eAAe,CAAE2C,IAAI,IAAK,CAAC,GAAGA,IAAI,EAAEZ,CAAC,CAAC,CAAC;IACzC,CAAC,CAAC,OAAOG,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,4BAA4B,EAAEF,GAAG,CAAC;MAChD5B,eAAe,CAAC,sCAAsC,CAAC;IACzD;EACF,CAAC;;EAED;EACA,MAAMsC,iBAAiB,GAAG,MAAOC,EAAE,IAAK;IACtC,IAAI,CAACpC,KAAK,EAAE;IAEZ,IAAI;MACF,MAAMjB,KAAK,CAACsD,MAAM,CAAC,sCAAsCD,EAAE,EAAE,EAAE;QAC7DnB,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUlB,KAAK;QAAG;MAC9C,CAAC,CAAC;MACFT,eAAe,CAAE2C,IAAI,IAAKA,IAAI,CAACI,MAAM,CAAEhB,CAAC,IAAKA,CAAC,CAACc,EAAE,KAAKA,EAAE,CAAC,CAAC;IAC5D,CAAC,CAAC,OAAOX,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,kCAAkC,EAAEF,GAAG,CAAC;MACtD5B,eAAe,CAAC,yCAAyC,CAAC;IAC5D;EACF,CAAC;;EAED;EACF,MAAM0C,WAAW,GAAG,MAAAA,CAAA,KAAY;IAC9B,MAAMvC,KAAK,GAAGY,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3Ca,OAAO,CAACc,GAAG,CAAC,EAAE,CAAC;IACf,IAAI,CAACxC,KAAK,EAAE;MACVH,eAAe,CAAC,4CAA4C,CAAC;MAC7D;IACF;IAEA,IAAI;MACF,MAAMkC,QAAQ,GAAG,MAAMU,KAAK,CAAC,iCAAiC,EAAE;QAC9DC,MAAM,EAAE,KAAK;QACbzB,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClC,eAAe,EAAE,UAAUjB,KAAK;QAClC;MACF,CAAC,CAAC;MAEF,IAAI,CAAC+B,QAAQ,CAACY,EAAE,EAAE;QAChB,MAAMC,OAAO,GAAG,MAAMb,QAAQ,CAACc,IAAI,CAAC,CAAC;QACrC,MAAM,IAAIC,KAAK,CAACF,OAAO,CAACG,OAAO,IAAI,qCAAqC,CAAC;MAC3E;MAEA,MAAM3B,IAAI,GAAG,MAAMW,QAAQ,CAACc,IAAI,CAAC,CAAC;MAClCnB,OAAO,CAACc,GAAG,CAAC,iBAAiB,EAAEpB,IAAI,CAAC4B,OAAO,CAAC;;MAE5C;MACArD,SAAS,CAACyB,IAAI,CAAC6B,WAAW,IAAI,CAAC,CAAC;IAClC,CAAC,CAAC,OAAOxB,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,4BAA4B,EAAEF,GAAG,CAAC;MAChD5B,eAAe,CAAC,kCAAkC,CAAC;IACrD;EACF,CAAC;EAEC,oBACEZ,OAAA,CAACC,UAAU,CAACgE,QAAQ;IAClBC,KAAK,EAAE;MACLnD,KAAK;MACLC,QAAQ;MACRC,OAAO;MACPZ,YAAY;MACZC,eAAe;MACfC,UAAU;MACVC,aAAa;MACbC,MAAM;MACNE,YAAY;MACZE,cAAc;MACdD,eAAe;MACfE,iBAAiB;MACjBK,cAAc;MACdC,iBAAiB;MACjBwB,cAAc;MACdM,iBAAiB;MACjBI;IACF,CAAE;IAAAnD,QAAA,EAEDA;EAAQ;IAAAgE,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACU,CAAC;AAE1B,CAAC;AAAClE,EAAA,CAlKWF,WAAW;AAAAqE,EAAA,GAAXrE,WAAW;AAAA,IAAAqE,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}